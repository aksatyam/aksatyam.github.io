<!DOCTYPE html>
<html>

<head>
  <title>Haptik JS SDK Integration Demo</title>
  <meta charset="UTF-8" />
  <meta content="width=device-width; initial-scale=1.0;" name="viewport" />
</head>

<body>
  Ely Bot Initialization
  <script>
    var environment = false;
    // var ssoid = findGetParameter('ssoid');
    // var token = findGetParameter('token');
    // var permission = findGetParameter('permission');
    // var botlist = findGetParameter('botlist');
    // var userType = findGetParameter('userType');

    // file:///Users/satyam/Desktop/index.html?ssoid=amhom2446&token=eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJhbWhvbTI0NDYiLCJpYXQiOjE3MDMyMDQwODksInN1YiI6ImFtaG9tMjQ0NiIsImlzcyI6IkFtYXJqaXQuTWFoYWRpa0BtYXhsaWZlaW5zdXJhbmNlLmNvbSIsImV4cCI6MTcwMzIxMTI4OX0.kzE2PlQUSy8lrbeegs2iXtDqWBHR--RCWWvchopVUyY&otlist=misbot_validated_key_bot_2017,hrbot_validated_key_bot_2017,N,N,N&userType=mnylEmployee

    var ssoid = 'amhom2446';
    var token = 'eyJhbGciOiJIUzI1NiJ9.eyJqdGkiOiJhbWhvbTI0NDYiLCJpYXQiOjE3MDMyMDQwODksInN1YiI6ImFtaG9tMjQ0NiIsImlzcyI6IkFtYXJqaXQuTWFoYWRpa0BtYXhsaWZlaW5zdXJhbmNlLmNvbSIsImV4cCI6MTcwMzIxMTI4OX0.kzE2PlQUSy8lrbeegs2iXtDqWBHR--RCWWvchopVUyY';
    var permission = ['CET', 'LW'];
    var botlist = 'misbot_validated_key_bot_2017,hrbot_validated_key_bot_2017,N,N,N';
    var userType = 'mnylEmployee';

    window.haptikInitSettings = {
      "business-id": getBusinessId(environment),
      "client-id": getClientId(environment),
      "base-url": getBaseURL(environment),
      'signup-type': 'third_party',
      'ignore-storage': true,
      "custom-css": "haptik.css",
      "botEvents": event => {
        console.log(JSON.stringify(event));
        if (event.event_name == "HAPTIK_BUTTON_CLICKED") {
          if (event.data.type == "LINK") {
            let url = event.data.value.url
            const uatProdURL = this.redirectionService.getTestMode() ? 'https://d3fcreaysfudlb.cloudfront.net/index_uat.html' : 'https://d3fcreaysfudlb.cloudfront.net/index.html';
            if (url.indexOf(uatProdURL) > -1) {
              // Launch MSD Bot

            }
            else {
              // Download File
            }
          }
        }
      },
    };

    function findGetParameter(parameterName) {
      var result = null,
        tmp = [];
      location.search
        .substr(1)
        .split("&")
        .forEach(function (item) {
          tmp = item.split("=");
          if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
        });
      return result;
    }

    function getBusinessId(environment) {
      return environment ? "5417" : "5417";
    }

    function getClientId(environment) {
      return environment ? "0d981d7da886e15be52654158ba5e64fe201ae52" : "0f699038facd3e065b5c9319cd64b49507dd71e1";
    }

    function getBaseURL(environment) {
      return environment ? "https://staging.hellohaptik.com/" : "https://api.haptikapi.com/";
    }

    function checkMisBotAndPermissionAccess(permission, botlist, userType) {
      const permissionList = permission ? permission : [];

      let btnObj = {
        display_mis: 'false',
        userType,
        permission: permissionList
      }
      if (/misbot_validated_key_bot_2017/i.test(botlist)) {
        btnObj.display_mis = 'true'
      }
      else if (/flsbot_validated_key_bot_2017/i.test(botlist)) {
        btnObj.display_mis = 'true'
      }
      else {
        btnObj.display_mis = 'false'
      }
      return btnObj
    }

  </script>
  <script type="text/javascript" charset="UTF-8" src="https://toolassets.haptikapi.com/platform/javascript-xdk/production/loader.js"></script>

  <script>
    document.addEventListener('haptik_sdk', function () {
      var userSignUp = {
        auth_id: ssoid,
        auth_code: token,
        custom_data: checkMisBotAndPermissionAccess(permission, botlist, userType)
      }
      HaptikSDK.signup(userSignUp, function (success, error, data) {
        if (success) {
          HaptikSDK.launchMessage("Menu", function () { }, true);
          HaptikSDK.show()
          function callbackFunction() {
          }
          console.log('SIGNUP REQUEST SUCCEEDED!', data);
        } else {
          console.log('ERROR:', error);
        }
      });
    });
  </script>

</html>